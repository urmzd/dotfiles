# Chezmoi configuration template
# This file configures chezmoi behavior and contains template variables

{{- $name := promptStringOnce . "name" "What is your full name" -}}
{{- $email := promptStringOnce . "email" "What is your primary email address" -}}
{{- $personal_email := promptStringOnce . "personal_email" "What is your personal email (for dotfiles repo)" -}}
{{- $work_email := promptStringOnce . "work_email" "What is your work email (optional, defaults to primary)" -}}
{{- $github_username := promptStringOnce . "github_username" "What is your GitHub username" -}}
{{- $gpg_signing_key := promptStringOnce . "gpg_signing_key" "GPG signing key ID (optional)" -}}

{{- $is_personal := promptBoolOnce . "is_personal" "Is this a personal machine (y/n)" -}}
{{- $is_work := promptBoolOnce . "is_work" "Is this a work machine (y/n)" -}}
{{- $use_secrets := promptBoolOnce . "use_secrets" "Do you want to use secrets management (y/n)" -}}
{{- $use_nix := promptBoolOnce . "use_nix" "Do you want to use Nix for development (y/n)" -}}
{{- $install_codex := promptBoolOnce . "install_codex" "Install OpenAI Codex CLI (y/n)" -}}

{{- if $use_secrets }}
encryption = "age"
{{- end }}

[data]
    name = {{ $name | quote }}
    email = {{ $email | quote }}
    personal_email = {{ $personal_email | quote }}
    work_email = {{ if ne $work_email "" }}{{ $work_email | quote }}{{ else }}{{ $email | quote }}{{ end }}
    github_username = {{ $github_username | quote }}
    gpg_signing_key = {{ $gpg_signing_key | quote }}

    # Machine type flags
    is_personal = {{ $is_personal }}
    is_work = {{ $is_work }}

    # Feature flags
    use_secrets = {{ $use_secrets }}
    use_nix = {{ $use_nix }}
    install_codex = {{ $install_codex }}

    # System detection
    is_macos = {{ eq .chezmoi.os "darwin" }}
    is_linux = {{ eq .chezmoi.os "linux" }}
    is_wsl = {{ env "WSL_DISTRO_NAME" | not | not }}

    # Package manager detection
    has_homebrew = {{ lookPath "brew" | not | not }}
    has_nix = {{ lookPath "nix" | not | not }}
    has_apt = {{ lookPath "apt" | not | not }}

    # Development tools detection
    has_direnv = {{ lookPath "direnv" | not | not }}

[git]
    autoCommit = true
    autoPush = false

{{- if $use_secrets }}
[age]
    suffix = ".age"
    identity = "~/.config/age/key.txt"
    recipient = "age1g2gr4rddcar2335xdqu6l2t40dpmmulq9jh7ne5873wa03fcxsdqv5mrk2"  # pragma: allowlist secret
{{- end }}

[cd]
    command = "code"

[edit]
    command = "nvim"

[merge]
    command = "nvim"
    args = ["-d", "{{ "{{ .Destination }}" }}", "{{ "{{ .Source }}" }}", "{{ "{{ .Target }}" }}"]

[diff]
    command = "nvim"
    args = ["-d", "{{ "{{ .Destination }}" }}", "{{ "{{ .Target }}" }}"]

# Template options
[template]
    options = ["missingkey=error"]
